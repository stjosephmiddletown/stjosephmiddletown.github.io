<script>
    // List of allowed base domains
    const allowedDomains = [
        'https://logwavers.com',
        'https://sub.logwavers.com',
    ];

    // Helper function to check if a URL is allowed
    const isAllowedDomain = (url) => {
        try {
            const parsedUrl = new URL(url);
            
            // Check if the hostname matches any allowed domains (including subdomains)
            const isSubdomainAllowed = allowedDomains.some((allowedDomain) => {
                const allowedBase = new URL(allowedDomain).hostname;
                return parsedUrl.hostname.endsWith(allowedBase);
            });

            // Check if the URL matches an allowed base and allows variations (trailing slashes, subfolders)
            const isUrlPathAllowed = allowedDomains.some((allowedDomain) => {
                const allowedBase = new URL(allowedDomain);
                return (
                    parsedUrl.origin === allowedBase.origin &&
                    parsedUrl.pathname.startsWith(allowedBase.pathname)
                );
            });

            return isSubdomainAllowed && isUrlPathAllowed;
        } catch (error) {
            console.error('Invalid URL format:', error);
            return false;
        }
    };

    // Retrieve and decode the hash from the URL
    const encodedHash = window.location.hash.substr(1); // Remove '#'
    try {
        const decodedUrl = window.atob(encodedHash); // Decode from Base64

        if (isAllowedDomain(decodedUrl)) {
            // Redirect if the URL is valid
            window.location.href = decodedUrl;
        } else {
            console.warn('Unrecognized or unsafe redirect URL');
        }
    } catch (error) {
        console.error('Error decoding the URL:', error);
    }
</script>
